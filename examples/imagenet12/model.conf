name: "caffe_config"
net {
  layer {
    name: "label"
    type: "LabelLayer"
    top: "softmax"
  }
  layer {
    name: "image"
    type: "ImageLayer"
    cropsize: 227
    mirror: true
    top: "conv1"
  }
  layer  {
    name: "conv1"
    type: "ConvLayer"
    num_output: 96
    window_size: 11
    stride: 4
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.01
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 0.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top: "relu1"
    bottom: "image"
  }
  layer {
    name: "relu1"
    type: "ReLULayer"
    top: "pool1"
    bottom :"conv1"
  }
  layer {
    name: "pool1"
    type: "PoolingLayer"
    pooling_method: kMaxPooling
    window_size: 3
    stride: 2
    top: "lrn1"
    bottom: "relu1"
  }
  layer {
    name: "lrn1"
    type: "LRNLayer"
    window_size: 5
    alpha: 0.0001
    beta: 0.75
    top: "conv2"
    bottom: "pool1"
  }
  layer {
    name: "conv2"
    type: "ConvLayer"
    num_output: 256
    num_groups: 2
    window_size: 5
    pad: 2
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.01
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 1.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 1.0
    }
    top: "relu1"
    bottom: "lrn1"
  }
  layer{
    name: "pool2"
    type: "PoolingLayer"
    pooling_method: kMaxPooling
    window_size: 3
    stride: 2
    top: "lrn2"
    bottom: "conv2"
  }
  layer {
    name: "lrn2"
    type: "LRNLayer"
    window_size: 5
    alpha: 0.0001
    beta: 0.75
    top: "conv2"
    bottom: "pool2"
  }
  layer {
    name: "conv3"
    type: "ConvLayer"
    num_output: 384
    window_size:3
    pad: 1
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.01
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value:0.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top:"conv4"
    bottom:"conv3"
  }
  layer {
    name: "conv4"
    type: "ConvLayer"
    num_output: 384
    num_groups: 2
    window_size: 3
    pad: 1
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.01
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 1.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top:"conv5"
    bottom:"conv3"
  }
  layer {
    name: "conv5"
    type: "ConvLayer"
    num_output: 256
    num_groups: 2
    window_size: 3
    pad: 1
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.01
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 1.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top: "pool5"
    bottom:"conv4"
  }
  layer {
    name: "pool5"
    type: "PoolingLayer"
    window_size: 3
    stride: 2
    top:"fc6"
    bottom:"pool5"
  }
  layer {
    name: "fc6"
    type: "FCLayer"
    num_output: 4096
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.005
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 1.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top:"fc7"
    bottom:"fc6"
  }
  layer {
    name: "fc7"
    type: "FCLayer"
    num_output: 4096
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.005
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 1.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top:"fc8"
    bottom:"fc6"
  }
  layer {
    name : "fc8"
    num_output: 1000
    type: "FCLayer"
    param {
      name: "weight"
      init_method: kGaussain
      std: 0.01
      learning_rate_multiplier: 1.0
      weight_decay_multiplier: 1.0
    }
    param {
      name: "bias"
      init_method: kConstant
      value: 0.0
      learning_rate_multiplier: 2.0
      weight_decay_multiplier: 0.0
    }
    top:"softmax"
    bottom: "fc7"
  }
  layer {
    name: "softmax"
    type: "SoftmaxLossLayer"
    bottom: "fc8"
    bottom: "label"
  }
}

solver {
  train_batchsize:32
  train_steps: 450000
  sgd{
    base_learning_rate: 0.01
    learning_rate_change:kStep
    learning_rate_change_steps:100000
    momentum: 0.9
    factor: 0.1
    weight_decay: 0.0005
  }
}

data{
  train_data{
    name: "imagenet"
    type: "ImageNetSource"
    image_folder:"/data0/wangwei/data/imagenet12/val_image"
    path: "/data0/wangwei/data/imagenet12/val_label.txt"
    mean_file: "/data0/wangwei/data/imagenet12/imagenet_mean.binaryproto"
    size: 1000
    shape{
      s: 3
      s: 256
      s: 256
    }
    shape{
      s: 1
    }
  }
}
